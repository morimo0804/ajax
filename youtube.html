<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <style>
      #player {
        display: block;
        margin: 0 auto 50px;
      }
      nav {
        margin-bottom: 20px;
      }
      li {
        list-style: none;
      }

      .inline-control {
        display: inline-block;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <!-- 1. ã“ã“ã®<div>ã‚¿ã‚°ãŒYoutubeã®<iframe>ã«ç½®ãæ›ã‚ã‚‹ã€‚ -->
    <div id="player"></div>
    <form>
      <input type="search" id="ytSearch" value="TRiDENT" />
      <button id="searchBtn">æ¤œç´¢</button>
    </form>
    <select class="searchlist"></select>
    <nav>
      <ul>
        <li id="doplay" class="inline-control">å†ç”Ÿ</li>
        <li id="dostop" class="inline-control">åœæ­¢</li>
        <li id="dopause" class="inline-control">ä¸€æ™‚åœæ­¢</li>
        <li id="mute" class="inline-control">ãƒŸãƒ¥ãƒ¼ãƒˆ</li>
        <li id="do10sNext" class="inline-control">10ç§’å…ˆã¸</li>
        <li id="do10sPrev" class="inline-control">10ç§’æˆ»ã‚‹</li>
        <li>
          <select id="MovieId" class="ytMovie" name="ytMovie">
            <option selected>é¸æŠã—ã¦ãã ã•ã„ã€‚</option>
            <option value="KuKYxjVw3V4">
              ã€I.CINNAMOROLL Animationã€‘Episode 1: Sketching
            </option>
            <option value="pTHHj6oeLzk">
              ã€I.CINNAMOROLL Animationã€‘Episode 2: Shopping
            </option>
            <option value="7Ts_z-J0w_k">
              ã€I.CINNAMOROLL Animationã€‘Episode 3: Glamping
            </option>
            <option value="JfU3N6zU1uU">
              ã€I.CINNAMOROLL Animationã€‘Episode 4: Harvest
            </option>
          </select>
        </li>
        <li>
          <form id="doSpeed">
            <input type="radio" id="mslow" name="speed" value="0.25" />
            <label for="mslow">0.25</label>
            <input type="radio" id="slow" name="speed" value="0.5" />
            <label for="slow">0.5</label>
            <input type="radio" id="normal" name="speed" value="1.0" checked />
            <label for="normal">1</label>
            <input type="radio" id="hspeed" name="speed" value="1.5" />
            <label for="hspeed">1.5</label>
            <input type="radio" id="mhspeed" name="speed" value="2" />
            <label for="mhspeed">2</label>
          </form>
        </li>
      </ul>
    </nav>
    <label
      >ãƒœãƒªãƒ¥ãƒ¼ãƒ <input
        type="range"
        min="0"
        max="100"
        name="volume"
        id="volume"
        value="50"
      />
      <span id="volumeNum"></span>
    </label>
    <h2>ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ</h2>
    <ul id="favoritesList"></ul>
    <button id="addFavorite">ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ </button>

    <script>
      // 2. å¤‰æ•°tagã«scriptã‚¿ã‚°ã‚’ä½œã£ã¦å…¥ã‚Œã‚‹ã€‚Element=è¦ç´ ã€Attrubute=å±æ€§
      let tag = document.createElement("script");

      tag.src = "https://www.youtube.com/iframe_api";
      let firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      //3.ã€€APIã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰ã€ã“ã®é–¢æ•°ã‚’<iframe>å†…ã«å½±éŸ¿ã•ã›ã‚‹ã€‚
      let player;
      let youtubeId = "UP1zTP5qcfw";

      function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
          height: "360",
          width: "640",
          videoId: youtubeId,
          playerVars: {
            playsinline: 1,
            controls: 0,
          },
          events: {
            onReady: onPlayerReady,
            //'onStateChange': onPlayerStateChange
          },
        });
      }

      // 4. ã“ã®APIã¯ã€video playderãŒæº–å‚™ã§ã—ãŸã‚‰ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
      function onPlayerReady(event) {
        event.target.playVideo();
        let currentVol = 5;
        event.target.setVolume(currentVol);
        document.querySelector("#volume").value = currentVol;
        document.querySelector("#volumeNum").textContent = currentVol;
      }

      /* 5. video playerã®ã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆçŠ¶æ…‹ï¼‰ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚
          å‹•ç”»ã‚’å†ç”Ÿã™ã‚‹ã¨ãã®è¨­å®šã¯ã€state=1ã«ã—ã¦ãŠãã¾ã™ã€‚
          ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€6000ãƒŸãƒªç§’å¾Œã«çµ‚äº†ã—ã¾ã™ã€‚ */
      let done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
          setTimeout(stopVideo, 6000);
          done = true;
        }
      }

      /* é–¢æ•°å®šç¾©
-----------------------------------------------------------------------------*/
      //åœæ­¢é–¢æ•°ã®å®šç¾©
      function stopVideo() {
        player.stopVideo();
      }
      //å†ç”Ÿé–¢æ•°ã®å®šç¾©
      function playTheVideo() {
        player.playVideo();
      }
      //ä¸€æ™‚åœæ­¢é–¢æ•°ã®å®šç¾©
      function pauseTheVideo() {
        player.pauseVideo();
      }
      //ãƒŸãƒ¥ãƒ¼ãƒˆé–¢æ•°ã®å®šç¾©
      function onMute() {
        //ãƒŸãƒ¥ãƒ¼ãƒˆã®æ™‚ã€trueã‚’è¿”ã™ã®ã§ãƒŸãƒ¥ãƒ¼ãƒˆã‚’è§£é™¤ã—ã¾ã™ã€‚
        if (player.isMuted()) {
          player.unMute();
        } else {
          //ãƒŸãƒ¥ãƒ¼ãƒˆãŒè§£é™¤ã•ã‚Œã¦ã„ã‚‹æ™‚ã¯falseãªã®ã§ã€ãƒŸãƒ¥ãƒ¼ãƒˆã«ã—ã¾ã™ã€‚
          player.mute();
        }
      }
      //10ç§’å‰ã«ã®é–¢æ•°ã®å®šç¾©
      function onePrev() {
        let currentTime = player.getCurrentTime();
        player.seekTo(currentTime - 10);
      }
      //10ç§’å¾Œã«ã®é–¢æ•°ã®å®šç¾©
      function oneNext() {
        let currentTime = player.getCurrentTime();
        player.seekTo(currentTime + 10);
      }
      //ãƒœãƒªãƒ¥ãƒ¼ãƒ é–¢æ•°ã®å®šç¾©
      function volumeFn(vol) {
        let currentVol = player.getVolume();
        player.setVolume(vol);
      }
      //å†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰é–¢æ•°ã®å®šç¾©
      function playSpeed(num) {
        //setPlaybackRateãŒå†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
        console.log(num);
        player.setPlaybackRate(num);
        player.playVideo();
      }

      /* ã‚¤ãƒ™ãƒ³ãƒˆ
-----------------------------------------------------------------------------*/
      //å†ç”Ÿã‚¤ãƒ™ãƒ³ãƒˆ
      let doplayBtn = document.querySelector("#doplay");
      doplayBtn.addEventListener("click", function () {
        playTheVideo(); //é–¢æ•°åã«å¤‰æ›´ã€é–¢æ•°ã®å®Ÿè¡Œ
      });

      //åœæ­¢ã‚¤ãƒ™ãƒ³ãƒˆ
      let dostopBtn = document.querySelector("#dostop");
      dostopBtn.addEventListener("click", function () {
        stopVideo();
      });

      //ä¸€æ™‚åœæ­¢ã‚¤ãƒ™ãƒ³ãƒˆ
      let dopauseBtn = document.querySelector("#dopause");
      dopauseBtn.addEventListener("click", function () {
        pauseTheVideo();
      });

      //ãƒŸãƒ¥ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
      let onMuteBtn = document.querySelector("#mute");
      onMuteBtn.addEventListener("click", function () {
        onMute();
        if (onMuteBtn.innerText === "ãƒŸãƒ¥ãƒ¼ãƒˆ") {
          onMuteBtn.innerText = "ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤";
        } else {
          onMuteBtn.innerText = "ãƒŸãƒ¥ãƒ¼ãƒˆ";
        }
      });

      //10ç§’å‰ã¸ã‚¤ãƒ™ãƒ³ãƒˆ
      let onePrevBtn = document.querySelector("#do10sPrev");
      onePrevBtn.addEventListener("click", function () {
        onePrev();
      });

      //10ç§’å¾Œã¸ã‚¤ãƒ™ãƒ³ãƒˆ
      let oneNextBtn = document.querySelector("#do10sNext");
      oneNextBtn.addEventListener("click", function () {
        oneNext();
      });

      //ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
      let volumeBtn = document.querySelector("#volume");
      let volumeTxt = document.querySelector("#volumeNum");
      volumeBtn.addEventListener("change", function () {
        volumeFn(this.value);
        volumeTxt.textContent = this.value;
      });

      //å‹•ç”»åˆ‡ã‚Šæ›¿ãˆã‚¤ãƒ™ãƒ³ãƒˆ
      let movieid = document.querySelector("#MovieId");
      movieid.addEventListener("change", function () {
        youtubeId = movieid.value;
        //ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
        player.destroy();
        onYouTubeIframeAPIReady();
      });

      //å†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
      let speedBtn = document.querySelector("#doSpeed");
      speedBtn.addEventListener("change", function () {
        //æ•°å€¤ã§ãªã„ã¨åŠ¹ã‹ãªã„ã®ã§ã€æ–‡å­—åˆ—ã‹ã‚‰æ•°å€¤ã«å¤‰æ›
        playSpeed(parseFloat(speedBtn.speed.value));
      });

      const selectvideo = document.querySelector(".searchlist");
      //æ¤œç´¢ã™ã‚‹é–¢æ•°ã®å®šç¾©
      function ytSearch(val) {
        const key = "AIzaSyARdA0I1IXo6MRXm_ntKbkQWWzjaHBsFzc"; //è‡ªåˆ†ã®ã‚­ãƒ¼ã«æ›¸ãæ›ãˆã¾ã™ã€‚
        const num = 10;
        const part = "snippet";
        const type = "video";
        const query = val;
        fetch(
          `https://www.googleapis.com/youtube/v3/search?type=${type}&part=${part}&maxResults=${num}&key=${key}&q=${query}&playsinline=1`
        )
          .then((data) => data.json())
          .then((obj) => {
            selectvideo.textContent = "";
            for (let movie of obj["items"]) {
              //å„videoIdã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—ã—ã¦å¤‰æ•°ã«ä»£å…¥
              const ytId = movie["id"]["videoId"];
              const ytTitle = movie["snippet"]["title"];
              //optionã‚’ä½œæˆã—ã¦ã€videoIdã¨titleã‚’æ‰€å®šã®å ´æ‰€ã«è¨­ç½®ã—ã€è¦ç´ ã‚’è¿½åŠ ã—ã¦ã„ãã€‚
              const optionTag = document.createElement("option");
              optionTag.textContent = ytTitle;
              optionTag.setAttribute("value", ytId);
              selectvideo.appendChild(optionTag);
            }
          });
      }

      //æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯æ“ä½œ
      const ytSearchBtn = document.querySelector("#searchBtn");
      ytSearchBtn.addEventListener("click", function (e) {
        const ytSearchVal = document.querySelector("#ytSearch").value;
        console.log(ytSearchVal); //æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
        ytSearch(ytSearchVal); //é–¢æ•°ã®å®Ÿè¡Œ
        e.preventDefault(); //æ¤œç´¢ãƒœã‚¿ãƒ³ã®é€ä¿¡ã‚’ã‚¹ãƒˆãƒƒãƒ—ã—ã¦ãŠãã€‚
      });

      // ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
      document.querySelector("#addFavorite").addEventListener("click", () => {
        const selectedOption = selectvideo.options[selectvideo.selectedIndex];
        if (!selectedOption || !selectedOption.value) return;

        const ytId = selectedOption.value;
        const ytTitle = selectedOption.textContent;
        saveFavorite(ytId, ytTitle);
      });

      /* ãŠæ°—ã«å…¥ã‚Šç™»éŒ²
-----------------------------------------------------------------------------*/
      // ãŠæ°—ã«å…¥ã‚Šä¿å­˜ã®é–¢æ•°
      function saveFavorite(id, title) {
        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        const isExist = favorites.some((item) => item.id === id);
        if (!isExist) {
          favorites.push({ id, title });
          localStorage.setItem("favorites", JSON.stringify(favorites));
          displayFavorites();
        }
      }

      // ãŠæ°—ã«å…¥ã‚Šè¡¨ç¤ºã®é–¢æ•°
      function displayFavorites() {
        const list = document.querySelector("#favoritesList");
        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        list.innerHTML = "";

        for (const fav of favorites) {
          const li = document.createElement("li");
          li.innerHTML = `
      <span>${fav.title}</span>
      <button data-id="${fav.id}" class="favPlay">â–¶ å†ç”Ÿ</button>
      <button data-id="${fav.id}" class="favRemove">ğŸ—‘ å‰Šé™¤</button>
      `;
          list.appendChild(li);
        }

        // å†ç”Ÿãƒœã‚¿ãƒ³
        document.querySelectorAll(".favPlay").forEach((btn) => {
          btn.addEventListener("click", () => {
            youtubeId = btn.dataset.id;
            player.destroy();
            onYouTubeIframeAPIReady();
          });
        });

        // å‰Šé™¤ãƒœã‚¿ãƒ³
        document.querySelectorAll(".favRemove").forEach((btn) => {
          btn.addEventListener("click", () => {
            let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
            favorites = favorites.filter((item) => item.id !== btn.dataset.id);
            localStorage.setItem("favorites", JSON.stringify(favorites));
            displayFavorites();
          });
        });
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãŠæ°—ã«å…¥ã‚Šè¡¨ç¤º
      window.addEventListener("DOMContentLoaded", () => {
        displayFavorites();
      });
    </script>
  </body>
</html>
