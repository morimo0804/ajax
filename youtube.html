<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <style>
      #player {
        width: 100%;
        margin: 50px 0 10px;
      }

      nav {
        margin-bottom: 20px;
      }

      ul {
        padding-left: 0;
      }

      li {
        list-style: none;
      }

      .inline-control {
        display: inline-block;
        margin-right: 10px;
      }

      .inner {
        width: 90%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .search {
        text-align: center;
      }

      .controls-wrapper {
        text-align: center;
        margin-top: 20px;
      }

      .controls-top,
      .controls-bottom {
        display: flex;
        justify-content: center;
        list-style: none;
        padding: 0;
        gap: 30px;
      }

      .controls-top {
        margin-bottom: 20px;
      }

      .control-btn {
        background-color: #e9e9e9;
        border: none;
        padding: 5px 8px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .control-btn:hover {
        background-color: #c2c2c2;
      }

      .setting {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
      }

      .setting ul {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
      }

      h2 {
        margin: 0;
      }

      .fav {
        display: flex;
        align-items: center;
        gap: 30px;
        margin: 30px 0 20px;
      }

      /* ã‚·ãƒ¼ã‚¯ãƒãƒ¼ */
      .bar-inner {
        width: 100%; /* è¦ªã‚³ãƒ³ãƒ†ãƒŠã®å¹…ã‚’100%ã« */
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 50px;
      }

      .seekbar-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #seekbar {
        width: 100%;
        flex: 1;
        appearance: none;
        height: 6px;
        background: #ddd;
        border-radius: 3px;
        outline: none;
        cursor: pointer;
        position: relative;
      }

      /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®é€²è¡Œãƒãƒ¼éƒ¨åˆ†ï¼ˆèµ¤è‰²ï¼‰ */
      #seekbar::-webkit-slider-thumb {
        appearance: none;
        width: 14px;
        height: 14px;
        background: red;
        border-radius: 50%;
        box-shadow: 0 0 0 1px white;
        margin-top: -4px;
        transition: background 0.3s ease;
      }

      #seekbar::-moz-range-thumb {
        width: 14px;
        height: 14px;
        background: red;
        border-radius: 50%;
        border: none;
        cursor: pointer;
      }

      #seekbar::-webkit-slider-runnable-track {
        background: red;
        height: 6px;
        border-radius: 3px;
      }

      #seekbar::-moz-range-track {
        background: red;
        height: 6px;
        border-radius: 3px;
      }

      /* ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #favoritesList {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 0;
        margin: 0;
      }

      #favoritesList li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
      }

      #favoritesList li span {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* å†ç”Ÿãƒœã‚¿ãƒ³ */
      .favPlay,
      .favRemove {
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .favPlay:hover,
      .favRemove:hover {
        background-color: #2980b9;
      }

      /* å‰Šé™¤ãƒœã‚¿ãƒ³ */
      .favRemove {
        background-color: #e74c3c;
      }

      .favRemove:hover {
        background-color: #c0392b;
      }

      #favoritesList li button {
        margin-left: 10px;
        padding: 5px 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      /* å†ç”Ÿãƒœã‚¿ãƒ³ã¨å‰Šé™¤ãƒœã‚¿ãƒ³ãŒæ¨ªä¸¦ã³ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ */
      #favoritesList li button.favPlay {
        margin-left: 10px;
      }

      #favoritesList li button.favRemove {
        margin-left: 10px;
      }

      /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ  */
      #favoritesList li {
        opacity: 0;
        animation: fadeIn 0.3s forwards;
      }

      @keyframes fadeIn {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }

      /* ãŠæ°—ã«å…¥ã‚Šè¿½åŠ ãƒœã‚¿ãƒ³ */
      #addFavorite {
        background-color: #2ecc71;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      #addFavorite:hover {
        background-color: #27ae60;
      }
    </style>
  </head>
  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <!-- 1. ã“ã“ã®<div>ã‚¿ã‚°ãŒYoutubeã®<iframe>ã«ç½®ãæ›ã‚ã‚‹ã€‚ -->
    <div class="inner">
      <div id="player"></div>
      <div class="bar-inner">
        <input type="range" id="seekbar" value="0" min="0" step="1" />
        <span id="time-display">0:00 / 0:00</span>
      </div>
      <div class="search">
        <form>
          <input type="search" id="ytSearch" value="TRiDENT" />
          <button id="searchBtn">æ¤œç´¢</button>
        </form>
        <select id="MovieId" class="ytMovie searchlist" name="ytMovie">
          <optgroup label="å›ºå®šå‹•ç”»">
            <option selected>é¸æŠã—ã¦ãã ã•ã„ã€‚</option>
            <option value="KuKYxjVw3V4">
              ã€I.CINNAMOROLL Animationã€‘Episode 1: Sketching
            </option>
            <option value="pTHHj6oeLzk">
              ã€I.CINNAMOROLL Animationã€‘Episode 2: Shopping
            </option>
            <option value="7Ts_z-J0w_k">
              ã€I.CINNAMOROLL Animationã€‘Episode 3: Glamping
            </option>
            <option value="JfU3N6zU1uU">
              ã€I.CINNAMOROLL Animationã€‘Episode 4: Harvest
            </option>
          </optgroup>
        </select>
      </div>
      <nav>
        <div class="controls-wrapper">
          <ul class="controls-top">
            <li>
              <button id="do10sPrev" class="control-btn">10ç§’æˆ»ã‚‹</button>
            </li>
            <li>
              <button id="togglePlayPause" class="control-btn">å†ç”Ÿ</button>
            </li>
            <li>
              <button id="do10sNext" class="control-btn">10ç§’å…ˆã¸</button>
            </li>
          </ul>
          <ul class="controls-bottom">
            <li><button id="dostop" class="control-btn">åœæ­¢</button></li>
            <li><button id="mute" class="control-btn">ãƒŸãƒ¥ãƒ¼ãƒˆ</button></li>
          </ul>
        </div>
      </nav>
      <div class="setting">
        <ul>
          <li>
            <form id="doSpeed">
              <input type="radio" id="mslow" name="speed" value="0.25" />
              <label for="mslow">0.25</label>
              <input type="radio" id="slow" name="speed" value="0.5" />
              <label for="slow">0.5</label>
              <input
                type="radio"
                id="normal"
                name="speed"
                value="1.0"
                checked
              />
              <label for="normal">1</label>
              <input type="radio" id="hspeed" name="speed" value="1.5" />
              <label for="hspeed">1.5</label>
              <input type="radio" id="mhspeed" name="speed" value="2" />
              <label for="mhspeed">2</label>
            </form>
          </li>
        </ul>
        <label
          >ãƒœãƒªãƒ¥ãƒ¼ãƒ <input
            type="range"
            min="0"
            max="100"
            name="volume"
            id="volume"
            value="50"
          />
          <span id="volumeNum"></span>
        </label>
      </div>
      <div class="fav">
        <h2>ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ</h2>
        <button id="addFavorite" class="control-btn">ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ </button>
      </div>
      <ul id="favoritesList"></ul>
    </div>

    <script>
      // 2. å¤‰æ•°tagã«scriptã‚¿ã‚°ã‚’ä½œã£ã¦å…¥ã‚Œã‚‹ã€‚Element=è¦ç´ ã€Attrubute=å±æ€§
      let tag = document.createElement("script");

      tag.src = "https://www.youtube.com/iframe_api";
      let firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      //3.ã€€APIã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰ã€ã“ã®é–¢æ•°ã‚’<iframe>å†…ã«å½±éŸ¿ã•ã›ã‚‹ã€‚
      let player;
      let youtubeId = "UP1zTP5qcfw";

      function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
          height: "360",
          width: "640",
          videoId: youtubeId,
          playerVars: {
            playsinline: 1,
            controls: 0,
          },
          events: {
            onReady: onPlayerReady,
            //'onStateChange': onPlayerStateChange
          },
        });
      }

      // ---- ã‚·ãƒ¼ã‚¯ãƒãƒ¼æ©Ÿèƒ½ã®è¿½åŠ  ----
      const seekbar = document.querySelector("#seekbar");

      // 4. ã“ã®APIã¯ã€video playderãŒæº–å‚™ã§ã—ãŸã‚‰ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
      function onPlayerReady(event) {
        event.target.playVideo();
        let currentVol = 5;
        event.target.setVolume(currentVol);
        document.querySelector("#volume").value = currentVol;
        document.querySelector("#volumeNum").textContent = currentVol;

        // å†ç”Ÿæ™‚é–“ã®è¡¨ç¤º
        const timeDisplay = document.querySelector("#time-display");

        setInterval(() => {
          if (player && player.getDuration) {
            const currentTime = player.getCurrentTime();
            const duration = player.getDuration();
            seekbar.max = duration;
            seekbar.value = currentTime;

            // æ™‚é–“ã‚’ mm:ss å½¢å¼ã«æ•´å½¢
            timeDisplay.textContent = `${formatTime(
              currentTime
            )} / ${formatTime(duration)}`;
          }
        }, 1000);

        // æ™‚é–“æ•´å½¢ã®ãŸã‚ã®é–¢æ•°
        function formatTime(seconds) {
          const m = Math.floor(seconds / 60);
          const s = Math.floor(seconds % 60);
          return `${m}:${s.toString().padStart(2, "0")}`;
        }
      }

      // ã‚·ãƒ¼ã‚¯ãƒãƒ¼æ“ä½œã«ã‚ˆã£ã¦å†ç”Ÿä½ç½®ã‚’å¤‰æ›´
      seekbar.addEventListener("input", () => {
        const seekTo = parseFloat(seekbar.value);
        player.seekTo(seekTo, true);
      });

      /* 5. video playerã®ã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆçŠ¶æ…‹ï¼‰ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚
          å‹•ç”»ã‚’å†ç”Ÿã™ã‚‹ã¨ãã®è¨­å®šã¯ã€state=1ã«ã—ã¦ãŠãã¾ã™ã€‚
          ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€6000ãƒŸãƒªç§’å¾Œã«çµ‚äº†ã—ã¾ã™ã€‚ */
      let done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
          setTimeout(stopVideo, 6000);
          done = true;
        }
      }

      /* é–¢æ•°å®šç¾©
-----------------------------------------------------------------------------*/
      //åœæ­¢é–¢æ•°ã®å®šç¾©
      function stopVideo() {
        player.stopVideo();
      }
      //å†ç”Ÿé–¢æ•°ã®å®šç¾©
      function playTheVideo() {
        player.playVideo();
      }
      //ä¸€æ™‚åœæ­¢é–¢æ•°ã®å®šç¾©
      function pauseTheVideo() {
        player.pauseVideo();
      }
      //ãƒŸãƒ¥ãƒ¼ãƒˆé–¢æ•°ã®å®šç¾©
      function onMute() {
        //ãƒŸãƒ¥ãƒ¼ãƒˆã®æ™‚ã€trueã‚’è¿”ã™ã®ã§ãƒŸãƒ¥ãƒ¼ãƒˆã‚’è§£é™¤ã—ã¾ã™ã€‚
        if (player.isMuted()) {
          player.unMute();
        } else {
          //ãƒŸãƒ¥ãƒ¼ãƒˆãŒè§£é™¤ã•ã‚Œã¦ã„ã‚‹æ™‚ã¯falseãªã®ã§ã€ãƒŸãƒ¥ãƒ¼ãƒˆã«ã—ã¾ã™ã€‚
          player.mute();
        }
      }
      //10ç§’å‰ã«ã®é–¢æ•°ã®å®šç¾©
      function onePrev() {
        let currentTime = player.getCurrentTime();
        player.seekTo(currentTime - 10);
      }
      //10ç§’å¾Œã«ã®é–¢æ•°ã®å®šç¾©
      function oneNext() {
        let currentTime = player.getCurrentTime();
        player.seekTo(currentTime + 10);
      }
      //ãƒœãƒªãƒ¥ãƒ¼ãƒ é–¢æ•°ã®å®šç¾©
      function volumeFn(vol) {
        let currentVol = player.getVolume();
        player.setVolume(vol);
      }
      //å†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰é–¢æ•°ã®å®šç¾©
      function playSpeed(num) {
        //setPlaybackRateãŒå†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
        console.log(num);
        player.setPlaybackRate(num);
        player.playVideo();
      }

      /* ã‚¤ãƒ™ãƒ³ãƒˆ
-----------------------------------------------------------------------------*/
      const playPauseBtn = document.getElementById("togglePlayPause");
      let isPlaying = false;

      playPauseBtn.addEventListener("click", () => {
        if (isPlaying) {
          pauseTheVideo();
          playPauseBtn.textContent = "å†ç”Ÿ";
        } else {
          playTheVideo();
          playPauseBtn.textContent = "ä¸€æ™‚åœæ­¢";
        }
        isPlaying = !isPlaying;
      });

      //åœæ­¢ã‚¤ãƒ™ãƒ³ãƒˆ
      let dostopBtn = document.querySelector("#dostop");
      dostopBtn.addEventListener("click", function () {
        stopVideo();
      });

      //ãƒŸãƒ¥ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
      let onMuteBtn = document.querySelector("#mute");
      onMuteBtn.addEventListener("click", function () {
        onMute();
        if (onMuteBtn.innerText === "ãƒŸãƒ¥ãƒ¼ãƒˆ") {
          onMuteBtn.innerText = "ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤";
        } else {
          onMuteBtn.innerText = "ãƒŸãƒ¥ãƒ¼ãƒˆ";
        }
      });

      //10ç§’å‰ã¸ã‚¤ãƒ™ãƒ³ãƒˆ
      let onePrevBtn = document.querySelector("#do10sPrev");
      onePrevBtn.addEventListener("click", function () {
        onePrev();
      });

      //10ç§’å¾Œã¸ã‚¤ãƒ™ãƒ³ãƒˆ
      let oneNextBtn = document.querySelector("#do10sNext");
      oneNextBtn.addEventListener("click", function () {
        oneNext();
      });

      //ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
      let volumeBtn = document.querySelector("#volume");
      let volumeTxt = document.querySelector("#volumeNum");
      volumeBtn.addEventListener("input", function () {
        let vol = this.value;
        player.setVolume(vol); // YouTubeã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æ›´æ–°
        volumeTxt.textContent = vol; // ãƒœãƒªãƒ¥ãƒ¼ãƒ è¡¨ç¤ºã‚’æ›´æ–°
      });

      //å‹•ç”»åˆ‡ã‚Šæ›¿ãˆã‚¤ãƒ™ãƒ³ãƒˆ
      let movieid = document.querySelector("#MovieId");
      movieid.addEventListener("change", function () {
        youtubeId = movieid.value;
        //ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
        player.destroy();
        onYouTubeIframeAPIReady();
      });

      //å†ç”Ÿã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
      let speedBtn = document.querySelector("#doSpeed");
      speedBtn.addEventListener("change", function () {
        //æ•°å€¤ã§ãªã„ã¨åŠ¹ã‹ãªã„ã®ã§ã€æ–‡å­—åˆ—ã‹ã‚‰æ•°å€¤ã«å¤‰æ›
        playSpeed(parseFloat(speedBtn.speed.value));
      });

      const selectvideo = document.querySelector(".searchlist");
      // æ¤œç´¢æ©Ÿèƒ½
      function ytSearch(query) {
        const key = "AIzaSyBiyIEeJyyVOYjKN4iO9gk-6E0UVgZ3Sxc";
        const url =
          "https://www.googleapis.com/youtube/v3/search" +
          "?type=video&part=snippet&maxResults=10" +
          "&key=" +
          key +
          "&q=" +
          encodeURIComponent(query);
        fetch(url)
          .then(function (res) {
            return res.json();
          })
          .then(function (data) {
            console.log(data);
            const list = document.querySelector("#MovieId");
            // ã€Œé¸æŠã—ã¦ãã ã•ã„ã€‚ã€ã‚’æ®‹ã—ã¦åˆæœŸåŒ–
            list.innerHTML = "<option selected>é¸æŠã—ã¦ãã ã•ã„ã€‚</option>";
            data.items.forEach(function (item) {
              const opt = document.createElement("option");
              opt.value = item.id.videoId;
              opt.textContent = item.snippet.title;
              list.appendChild(opt);
            });
          });
      }

      //æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯æ“ä½œ
      const ytSearchBtn = document.querySelector("#searchBtn");
      ytSearchBtn.addEventListener("click", function (e) {
        const ytSearchVal = document.querySelector("#ytSearch").value;
        console.log(ytSearchVal); //æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
        ytSearch(ytSearchVal); //é–¢æ•°ã®å®Ÿè¡Œ
        e.preventDefault(); //æ¤œç´¢ãƒœã‚¿ãƒ³ã®é€ä¿¡ã‚’ã‚¹ãƒˆãƒƒãƒ—ã—ã¦ãŠãã€‚
      });

      // ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
      document.querySelector("#addFavorite").addEventListener("click", () => {
        const selectvideo = document.querySelector(".searchlist");
        if (!selectvideo) {
          alert("å‹•ç”»ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        const selectedOption = selectvideo.options[selectvideo.selectedIndex];
        if (!selectedOption || !selectedOption.value) {
          alert("å‹•ç”»ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");
          return;
        }

        const ytId = selectedOption.value;
        const ytTitle = selectedOption.textContent;
        saveFavorite(ytId, ytTitle);
      });

      /* ãŠæ°—ã«å…¥ã‚Šç™»éŒ²
-----------------------------------------------------------------------------*/
      // ãŠæ°—ã«å…¥ã‚Šä¿å­˜ã®é–¢æ•°
      function saveFavorite(id, title) {
        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        const isExist = favorites.some((item) => item.id === id);
        if (!isExist) {
          favorites.push({ id, title });
          localStorage.setItem("favorites", JSON.stringify(favorites));
          displayFavorites();
        }
      }

      // ãŠæ°—ã«å…¥ã‚Šè¡¨ç¤ºã®é–¢æ•°
      function displayFavorites() {
        const list = document.querySelector("#favoritesList");
        const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        list.innerHTML = "";

        for (const fav of favorites) {
          const li = document.createElement("li");
          li.innerHTML = `
      <span>${fav.title}</span>
      <button data-id="${fav.id}" class="favPlay">â–¶ å†ç”Ÿ</button>
      <button data-id="${fav.id}" class="favRemove">ğŸ—‘ å‰Šé™¤</button>
      `;
          list.appendChild(li);
        }

        // å†ç”Ÿãƒœã‚¿ãƒ³
        document.querySelectorAll(".favPlay").forEach((btn) => {
          btn.addEventListener("click", () => {
            youtubeId = btn.dataset.id;
            player.destroy();
            onYouTubeIframeAPIReady();
          });
        });

        // å‰Šé™¤ãƒœã‚¿ãƒ³
        document.querySelectorAll(".favRemove").forEach((btn) => {
          btn.addEventListener("click", () => {
            let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
            favorites = favorites.filter((item) => item.id !== btn.dataset.id);
            localStorage.setItem("favorites", JSON.stringify(favorites));
            displayFavorites();
          });
        });
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãŠæ°—ã«å…¥ã‚Šè¡¨ç¤º
      window.addEventListener("DOMContentLoaded", () => {
        displayFavorites();
      });
    </script>
  </body>
</html>
